# ğŸ¯ UrbanPing íŠ¸ë¦¬ê±° ê°œë°œ ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨

1. [íŠ¸ë¦¬ê±° ì‹œìŠ¤í…œ ê°œìš”](#-íŠ¸ë¦¬ê±°-ì‹œìŠ¤í…œ-ê°œìš”)
2. [ìƒˆë¡œìš´ íŠ¸ë¦¬ê±° ì „ëµ ê°œë°œ](#-ìƒˆë¡œìš´-íŠ¸ë¦¬ê±°-ì „ëµ-ê°œë°œ)
3. [íŠ¸ë¦¬ê±° ì„¤ì • ê´€ë¦¬](#-íŠ¸ë¦¬ê±°-ì„¤ì •-ê´€ë¦¬)
4. [í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ](#-í…ŒìŠ¤íŠ¸-ê°€ì´ë“œ)
5. [ëª¨ë²” ì‚¬ë¡€](#-ëª¨ë²”-ì‚¬ë¡€)
6. [ë¬¸ì œ í•´ê²°](#-ë¬¸ì œ-í•´ê²°)

## ğŸ” íŠ¸ë¦¬ê±° ì‹œìŠ¤í…œ ê°œìš”

### ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Trigger Manager                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Strategy Registryâ”‚  â”‚ Context Builder â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Trigger Strategies                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Weather Trigger â”‚  â”‚ Location Triggerâ”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Event Publishers                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Notification    â”‚  â”‚ History Logger  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ ì»´í¬ë„ŒíŠ¸

1. **TriggerManager**: íŠ¸ë¦¬ê±° ì „ëµ ê´€ë¦¬ ë° ì‹¤í–‰
2. **TriggerStrategy**: ê°œë³„ íŠ¸ë¦¬ê±° ë¡œì§ êµ¬í˜„
3. **TriggerContext**: í‰ê°€ì— í•„ìš”í•œ ë°ì´í„° ì „ë‹¬
4. **TriggerResult**: í‰ê°€ ê²°ê³¼ ë° ì•Œë¦¼ ì •ë³´

## ğŸ›  ìƒˆë¡œìš´ íŠ¸ë¦¬ê±° ì „ëµ ê°œë°œ

### 1. íŠ¸ë¦¬ê±° ì „ëµ í´ë˜ìŠ¤ ìƒì„±

```java
@Component
public class CustomTriggerStrategy implements TriggerStrategy {
    
    @Override
    public TriggerResult evaluate(TriggerContext context) {
        // íŠ¸ë¦¬ê±° ë¡œì§ êµ¬í˜„
        if (triggerConditionMet()) {
            return TriggerResult.triggered(
                NotificationType.CUSTOM,
                TriggerCondition.CUSTOM,
                "ì•Œë¦¼ ì œëª©",
                "ì•Œë¦¼ ë©”ì‹œì§€",
                "ìœ„ì¹˜ ì •ë³´"
            );
        }
        return TriggerResult.notTriggered();
    }
    
    @Override
    public String getSupportedTriggerType() {
        return "CUSTOM_TRIGGER";
    }
    
    @Override
    public String getDescription() {
        return "ì‚¬ìš©ì ì •ì˜ íŠ¸ë¦¬ê±° ì„¤ëª…";
    }
    
    @Override
    public int getPriority() {
        return 50; // ìš°ì„ ìˆœìœ„ ì„¤ì •
    }
}
```

### 2. ì„¤ì • ê´€ë¦¬ ì¶”ê°€

```java
@ConfigurationProperties(prefix = "urbanping.trigger.custom")
@Component
@Getter
@Setter
public class CustomTriggerProperties {
    private double threshold = 10.0;
    private int interval = 300;
    private boolean enabled = true;
}
```

### 3. í…ŒìŠ¤íŠ¸ ì‘ì„±

```java
@SpringBootTest
class CustomTriggerStrategyTest {
    
    @Autowired
    private CustomTriggerStrategy strategy;
    
    @Test
    void whenConditionMet_thenTriggerFires() {
        // Given
        TriggerContext context = createTestContext();
        
        // When
        TriggerResult result = strategy.evaluate(context);
        
        // Then
        assertTrue(result.isTriggered());
        assertEquals("ì•Œë¦¼ ì œëª©", result.getTitle());
    }
}
```

## âš™ï¸ íŠ¸ë¦¬ê±° ì„¤ì • ê´€ë¦¬

### ì„¤ì • íŒŒì¼ (application.yml)

```yaml
urbanping:
  trigger:
    enabled: true
    scheduler:
      realtime-interval: 300000  # 5ë¶„
    temperature:
      high-threshold: 35.0
      low-threshold: 0.0
    air-quality:
      pm10-threshold: 100
      pm25-threshold: 50
    bike-share:
      shortage-threshold: 2
      excess-threshold: 15
```

### ë™ì  ì„¤ì • ë³€ê²½

```java
@RestController
@RequestMapping("/api/triggers/config")
public class TriggerConfigController {
    
    @PutMapping("/{triggerType}/threshold")
    public ResponseEntity<Void> updateThreshold(
            @PathVariable String triggerType,
            @RequestParam double value) {
        // ì„¤ì • ì—…ë°ì´íŠ¸ ë¡œì§
    }
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

### 1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

- ê° íŠ¸ë¦¬ê±° ì „ëµ ë³„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±
- ê²½ê³„ê°’ í…ŒìŠ¤íŠ¸ í•„ìˆ˜
- ì‹¤íŒ¨ ì¼€ì´ìŠ¤ ì²˜ë¦¬ ê²€ì¦

### 2. í†µí•© í…ŒìŠ¤íŠ¸

```java
@SpringBootTest
class TriggerIntegrationTest {
    
    @Autowired
    private TriggerManager triggerManager;
    
    @Test
    void whenMultipleTriggersActive_thenHighestPriorityWins() {
        // í…ŒìŠ¤íŠ¸ êµ¬í˜„
    }
}
```

### 3. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

```java
@Test
void performanceTest() {
    int userCount = 1000;
    long startTime = System.currentTimeMillis();
    
    // ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë¡œì§
    
    long endTime = System.currentTimeMillis();
    assertTrue((endTime - startTime) < 5000); // 5ì´ˆ ì´ë‚´ ì²˜ë¦¬
}
```

## ğŸ’¡ ëª¨ë²” ì‚¬ë¡€

1. **ìš°ì„ ìˆœìœ„ ê´€ë¦¬**
   - ê¸´ê¸‰ ì•Œë¦¼: 0-10
   - ì¤‘ìš” ì•Œë¦¼: 11-30
   - ì¼ë°˜ ì•Œë¦¼: 31-70
   - ì •ë³´ì„± ì•Œë¦¼: 71-100

2. **ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€**
   ```java
   private boolean isRecentlyTriggered(String userId, String triggerType) {
       return triggerHistoryRepository.existsRecentTrigger(
           userId, triggerType, LocalDateTime.now().minusMinutes(30)
       );
   }
   ```

3. **ì—ëŸ¬ ì²˜ë¦¬**
   ```java
   try {
       // íŠ¸ë¦¬ê±° ë¡œì§
   } catch (Exception e) {
       log.error("íŠ¸ë¦¬ê±° í‰ê°€ ì‹¤íŒ¨: {}", e.getMessage(), e);
       return TriggerResult.notTriggered();
   }
   ```

## ğŸ”§ ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ë¬¸ì œ

1. **ì„±ëŠ¥ ì´ìŠˆ**
   - ìºì‹± ì ìš©
   - ë°°ì¹˜ ì²˜ë¦¬ í™œìš©
   - ë¹„ë™ê¸° ì²˜ë¦¬ ê²€í† 

2. **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜**
   - ì£¼ê¸°ì  ë¦¬ì†ŒìŠ¤ ì •ë¦¬
   - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§

3. **ë™ì‹œì„± ë¬¸ì œ**
   - ë½ ë§¤ì»¤ë‹ˆì¦˜ í™œìš©
   - ë™ì‹œì„± ì œì–´ íŒ¨í„´ ì ìš©

### ë””ë²„ê¹… íŒ

```java
@Slf4j
public class TriggerDebugUtil {
    public static void logTriggerContext(TriggerContext context) {
        log.debug("íŠ¸ë¦¬ê±° ì»¨í…ìŠ¤íŠ¸: userId={}, location=[{}, {}], interests={}",
            context.getUser().getId(),
            context.getUserLatitude(),
            context.getUserLongitude(),
            context.getUserInterests()
        );
    }
}
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§

### ë©”íŠ¸ë¦­ ìˆ˜ì§‘

```java
@Component
public class TriggerMetrics {
    private final MeterRegistry registry;
    
    public void recordTriggerExecution(String triggerType, boolean success) {
        registry.counter("trigger.executions", 
            "type", triggerType,
            "result", success ? "success" : "failure"
        ).increment();
    }
}
```

### ëŒ€ì‹œë³´ë“œ êµ¬ì„±

1. íŠ¸ë¦¬ê±° ì‹¤í–‰ íšŸìˆ˜
2. ì„±ê³µ/ì‹¤íŒ¨ìœ¨
3. í‰ê·  ì‹¤í–‰ ì‹œê°„
4. ì‚¬ìš©ìë³„ íŠ¸ë¦¬ê±° ë°œë™ í†µê³„

## ğŸ”„ ë°°í¬ í”„ë¡œì„¸ìŠ¤

1. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
2. ì„¤ì • ê²€ì¦
3. ë‹¨ê³„ì  ë¡¤ì•„ì›ƒ
4. ëª¨ë‹ˆí„°ë§ ê°•í™”

## ğŸ“ ë¬¸ì„œí™” ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] íŠ¸ë¦¬ê±° ì„¤ëª…
- [ ] ì„¤ì • íŒŒë¼ë¯¸í„°
- [ ] í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
- [ ] API ë¬¸ì„œ
- [ ] ëª¨ë‹ˆí„°ë§ ì§€í‘œ

## ğŸ¤ ê¸°ì—¬ ê°€ì´ë“œ

1. ì´ìŠˆ ìƒì„±
2. ë¸Œëœì¹˜ ìƒì„±
3. ì½”ë“œ ì‘ì„±
4. í…ŒìŠ¤íŠ¸ ì¶”ê°€
5. PR ì œì¶œ

## ğŸ“š ì°¸ê³  ìë£Œ

- [Spring Boot ë¬¸ì„œ](https://docs.spring.io/spring-boot/docs/current/reference/html/)
- [í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜](https://netflixtechblog.com/ready-for-changes-with-hexagonal-architecture-b315ec967749)
- [ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜](https://microservices.io/patterns/data/event-driven-architecture.html)
